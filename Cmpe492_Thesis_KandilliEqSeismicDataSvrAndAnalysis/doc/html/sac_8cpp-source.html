<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Kandilli Earthquake Seismic Data Server and Analysis: sac.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<h1>sac.cpp</h1><a href="sac_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include "<a class="code" href="sac_8h.html">sac.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="stringop_8h.html">stringop.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="window_8h.html">window.h</a>"</span>
<a name="l00012"></a>00012 <span class="keyword">using namespace </span>std;
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="keyword">extern</span> <span class="stringliteral">"C"</span>
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016         <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="sac_8cpp.html#694baed087b4d88460bebb4e58c85ef6">hyp02d_</a>();
<a name="l00017"></a>00017         <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="sac_8cpp.html#342f0d285273c7925512954cf4898ac2">apick_</a>(<span class="keyword">const</span> <span class="keywordtype">float</span>* arry,<span class="keywordtype">float</span>&amp; <a class="code" href="sac_8cpp.html#33fb4519948396073f59faf480e18c19">nlen</a>,<span class="keywordtype">float</span>&amp; <a class="code" href="sac_8cpp.html#1ee4a05b54419bfadd66ee351d05812e">delta</a>,<span class="keywordtype">float</span>&amp; <a class="code" href="sac_8cpp.html#87aa6e6a76be11cf5af32fe6c721014e">ndxst</a>,<span class="keyword">const</span> <span class="keywordtype">float</span>* <a class="code" href="sac_8cpp.html#1cf3efb282fcd7a434e15a4b211972ff">cAry</a>,<span class="keywordtype">long</span> <span class="keywordtype">int</span>&amp; <a class="code" href="sac_8cpp.html#a40be8b45b8649a7bfe61482161c6102">ndxpk</a>,<span class="keywordtype">float</span>&amp; <a class="code" href="sac_8cpp.html#07548050eb10f780b40910a30a6139e6">nlncda</a>,<span class="keywordtype">long</span> <span class="keywordtype">int</span>&amp; <a class="code" href="sac_8cpp.html#e966de147bf527c0887976a579db9a1f">itype</a>,<span class="keywordtype">long</span> <span class="keywordtype">int</span>&amp; <a class="code" href="sac_8cpp.html#1a628075fc57be35265c4af95ac761fe">iqual</a>,<span class="keywordtype">float</span>&amp; <a class="code" href="sac_8cpp.html#916ffb904b1b852e8cf354dc976dc508">updwn</a>);
<a name="l00018"></a>00018 }
<a name="l00019"></a>00019 <span class="comment">//Input parameters</span>
<a name="l00020"></a><a class="code" href="sac_8cpp.html#57ba9c584cf7756552b7d4370e93395f">00020</a> <span class="keywordtype">float</span>* <a class="code" href="sac_8cpp.html#57ba9c584cf7756552b7d4370e93395f">data</a>;
<a name="l00021"></a><a class="code" href="sac_8cpp.html#33fb4519948396073f59faf480e18c19">00021</a> <span class="keywordtype">float</span> <a class="code" href="sac_8cpp.html#33fb4519948396073f59faf480e18c19">nlen</a>, <a class="code" href="sac_8cpp.html#1ee4a05b54419bfadd66ee351d05812e">delta</a>, <a class="code" href="sac_8cpp.html#87aa6e6a76be11cf5af32fe6c721014e">ndxst</a>;
<a name="l00022"></a>00022 <span class="comment">// cAry of Kandilli</span>
<a name="l00023"></a>00023 <span class="comment">//float cAry[] = {0.985,3.0,0.6,0.03,5.0,0.0039,100.0,-0.1,2.0,3.0,1.0,3,40,3,0,0,0};//standart olan</span>
<a name="l00024"></a><a class="code" href="sac_8cpp.html#1cf3efb282fcd7a434e15a4b211972ff">00024</a> <span class="keywordtype">float</span> <a class="code" href="sac_8cpp.html#1cf3efb282fcd7a434e15a4b211972ff">cAry</a>[] = {0.95,1.0,0.15,0.005,11.0,0.0039,1000000.0,-0.1,2.0,3.0,1.0,3,40,3,0,0,0};
<a name="l00025"></a>00025 <span class="comment">// Output parameters</span>
<a name="l00026"></a><a class="code" href="sac_8cpp.html#d34fab0272229305cfd14e2348a271fd">00026</a> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="sac_8cpp.html#a40be8b45b8649a7bfe61482161c6102">ndxpk</a>,<a class="code" href="sac_8cpp.html#e966de147bf527c0887976a579db9a1f">itype</a>,<a class="code" href="sac_8cpp.html#1a628075fc57be35265c4af95ac761fe">iqual</a>,<a class="code" href="sac_8cpp.html#d34fab0272229305cfd14e2348a271fd">nzyear</a>,<a class="code" href="sac_8cpp.html#710a9f97e615d02344560edcc40ed3cc">nzhour</a>,<a class="code" href="sac_8cpp.html#2bff6107ebc08f6f923c14d4b17a5b10">nzmin</a>,<a class="code" href="sac_8cpp.html#28cce63cfb90bf37cb5ffb2773e84795">nzsec</a>,<a class="code" href="sac_8cpp.html#aa85ccd0618fefb05e39ad9296f37226">nzmsec</a>,<a class="code" href="sac_8cpp.html#0dfaef8180fb0cc32bb591f2126160f5">nzjday</a>;
<a name="l00027"></a><a class="code" href="sac_8cpp.html#916ffb904b1b852e8cf354dc976dc508">00027</a> <span class="keywordtype">float</span> <a class="code" href="sac_8cpp.html#07548050eb10f780b40910a30a6139e6">nlncda</a>,<a class="code" href="sac_8cpp.html#916ffb904b1b852e8cf354dc976dc508">updwn</a>;
<a name="l00028"></a><a class="code" href="sac_8cpp.html#8599b25176ac5a7eeca5af2a3415d821">00028</a> <span class="keywordtype">char</span> <a class="code" href="sac_8cpp.html#8599b25176ac5a7eeca5af2a3415d821">kstnm</a>[8];
<a name="l00029"></a><a class="code" href="sac_8cpp.html#7ef1b16619d5d4998730fe6343d0654a">00029</a> <span class="keywordtype">int</span> <a class="code" href="sac_8cpp.html#7ef1b16619d5d4998730fe6343d0654a">windowNum</a>;
<a name="l00030"></a><a class="code" href="sac_8cpp.html#328345a029b9a68b2dbf673ac84727d5">00030</a> <span class="keywordtype">int</span> <a class="code" href="sac_8cpp.html#328345a029b9a68b2dbf673ac84727d5">windowSlideNum</a>;
<a name="l00031"></a>00031 
<a name="l00041"></a><a class="code" href="classsac.html#719190d6770bcdb6032fe3dd61eefdde">00041</a> <span class="keywordtype">void</span> <a class="code" href="classsac.html#719190d6770bcdb6032fe3dd61eefdde">sac::readFile</a>(<span class="keywordtype">string</span> fileName)
<a name="l00042"></a>00042 {
<a name="l00043"></a>00043         <a class="code" href="structsac__header.html">sac_header</a> mysac;
<a name="l00044"></a>00044         fstream f2;     
<a name="l00045"></a>00045         f2.open(fileName.c_str(), ios::binary | ios::in);
<a name="l00046"></a>00046         <span class="keywordflow">if</span> (!f2)
<a name="l00047"></a>00047         {
<a name="l00048"></a>00048                 cout &lt;&lt; <span class="stringliteral">"cannot open the file"</span> &lt;&lt; endl;
<a name="l00049"></a>00049                 <span class="keywordflow">return</span>;
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="comment">// Header</span>
<a name="l00053"></a>00053         f2.read((<span class="keywordtype">char</span>*)&amp;mysac,<span class="keyword">sizeof</span>(<a class="code" href="structsac__header.html">sac_header</a>));      
<a name="l00054"></a>00054         
<a name="l00055"></a>00055         <a class="code" href="sac_8cpp.html#1ee4a05b54419bfadd66ee351d05812e">delta</a> = mysac.delta;
<a name="l00056"></a>00056         <a class="code" href="sac_8cpp.html#87aa6e6a76be11cf5af32fe6c721014e">ndxst</a> = 1;
<a name="l00057"></a>00057         <span class="comment">// Take number of samples variable from the header</span>
<a name="l00058"></a>00058         <a class="code" href="sac_8cpp.html#33fb4519948396073f59faf480e18c19">nlen</a> = mysac.npts;      
<a name="l00059"></a>00059         <a class="code" href="sac_8cpp.html#57ba9c584cf7756552b7d4370e93395f">data</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[(long)<a class="code" href="sac_8cpp.html#33fb4519948396073f59faf480e18c19">nlen</a>];
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         <span class="comment">// Read data accoring to the number of samples</span>
<a name="l00062"></a>00062         f2.read((<span class="keywordtype">char</span>*)<a class="code" href="sac_8cpp.html#57ba9c584cf7756552b7d4370e93395f">data</a>, (<span class="keywordtype">long</span>)<a class="code" href="sac_8cpp.html#33fb4519948396073f59faf480e18c19">nlen</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00063"></a>00063         
<a name="l00064"></a>00064         <span class="comment">/*for (int i = 0; i &lt; 30; i++)</span>
<a name="l00065"></a>00065 <span class="comment">        {</span>
<a name="l00066"></a>00066 <span class="comment">                cout &lt;&lt; "Data: " &lt;&lt; data[i] &lt;&lt; endl;</span>
<a name="l00067"></a>00067 <span class="comment">        }*/</span>
<a name="l00068"></a>00068                 
<a name="l00069"></a>00069         f2.close();
<a name="l00070"></a>00070         
<a name="l00071"></a>00071         <a class="code" href="sac_8cpp.html#1cf3efb282fcd7a434e15a4b211972ff">cAry</a>[14] = <a class="code" href="sac_8cpp.html#33fb4519948396073f59faf480e18c19">nlen</a>;
<a name="l00072"></a>00072         <a class="code" href="sac_8cpp.html#1cf3efb282fcd7a434e15a4b211972ff">cAry</a>[15] = <a class="code" href="sac_8cpp.html#1ee4a05b54419bfadd66ee351d05812e">delta</a>;
<a name="l00073"></a>00073         <a class="code" href="sac_8cpp.html#1cf3efb282fcd7a434e15a4b211972ff">cAry</a>[16] =  <a class="code" href="sac_8cpp.html#87aa6e6a76be11cf5af32fe6c721014e">ndxst</a>;
<a name="l00074"></a>00074         <a class="code" href="sac_8cpp.html#d34fab0272229305cfd14e2348a271fd">nzyear</a> = mysac.nzyear;
<a name="l00075"></a>00075         <a class="code" href="sac_8cpp.html#0dfaef8180fb0cc32bb591f2126160f5">nzjday</a> = mysac.nzjday;
<a name="l00076"></a>00076         <a class="code" href="sac_8cpp.html#710a9f97e615d02344560edcc40ed3cc">nzhour</a> = mysac.nzhour;
<a name="l00077"></a>00077         <a class="code" href="sac_8cpp.html#2bff6107ebc08f6f923c14d4b17a5b10">nzmin</a> = mysac.nzmin;
<a name="l00078"></a>00078         <a class="code" href="sac_8cpp.html#28cce63cfb90bf37cb5ffb2773e84795">nzsec</a> = mysac.nzsec;
<a name="l00079"></a>00079         <a class="code" href="sac_8cpp.html#aa85ccd0618fefb05e39ad9296f37226">nzmsec</a> = mysac.nzmsec;
<a name="l00080"></a>00080         
<a name="l00081"></a>00081         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;8; i++)
<a name="l00082"></a>00082                 <a class="code" href="sac_8cpp.html#8599b25176ac5a7eeca5af2a3415d821">kstnm</a>[i] = mysac.kstnm[i];
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00086"></a><a class="code" href="classsac.html#7b665d6e5efa588ba3e451c174f7c52b">00086</a> <span class="keywordtype">void</span> <a class="code" href="classsac.html#7b665d6e5efa588ba3e451c174f7c52b">sac::callHYP02d</a>()
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088         <a class="code" href="sac_8cpp.html#694baed087b4d88460bebb4e58c85ef6">hyp02d_</a>();
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00111"></a><a class="code" href="classsac.html#c6e06e0f852b0e30eb5a48981e553d46">00111</a> <span class="keywordtype">void</span> <a class="code" href="classsac.html#c6e06e0f852b0e30eb5a48981e553d46">sac::callAPicker</a>(<span class="keywordtype">float</span> *tempData, <span class="keywordtype">float</span> windowSize)
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113         <a class="code" href="sac_8cpp.html#1cf3efb282fcd7a434e15a4b211972ff">cAry</a>[14] = windowSize;
<a name="l00114"></a>00114         <a class="code" href="sac_8cpp.html#342f0d285273c7925512954cf4898ac2">apick_</a>(tempData,windowSize,<a class="code" href="sac_8cpp.html#1ee4a05b54419bfadd66ee351d05812e">delta</a>,<a class="code" href="sac_8cpp.html#87aa6e6a76be11cf5af32fe6c721014e">ndxst</a>,<a class="code" href="sac_8cpp.html#1cf3efb282fcd7a434e15a4b211972ff">cAry</a>,<a class="code" href="sac_8cpp.html#a40be8b45b8649a7bfe61482161c6102">ndxpk</a>,<a class="code" href="sac_8cpp.html#07548050eb10f780b40910a30a6139e6">nlncda</a>,<a class="code" href="sac_8cpp.html#e966de147bf527c0887976a579db9a1f">itype</a>,<a class="code" href="sac_8cpp.html#1a628075fc57be35265c4af95ac761fe">iqual</a>,<a class="code" href="sac_8cpp.html#916ffb904b1b852e8cf354dc976dc508">updwn</a>);
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00118"></a><a class="code" href="classsac.html#ab6d49cb4b4810eaecc99ca1877a45cb">00118</a> <span class="keywordtype">void</span> <a class="code" href="classsac.html#ab6d49cb4b4810eaecc99ca1877a45cb">sac::calculatePickValue</a>(<span class="keywordtype">string</span> fileName, <a class="code" href="classwindow.html">window</a> windowList[],<span class="keywordtype">int</span> windowSec,
<a name="l00119"></a>00119                 <span class="keywordtype">int</span> windowSlideSec)
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121         <a class="code" href="classsac.html#719190d6770bcdb6032fe3dd61eefdde">readFile</a>(fileName);
<a name="l00122"></a>00122         <a class="code" href="classsac.html#8f84a629ca40a613402d5de241bc69d8">setWindow</a>(windowSec, windowSlideSec);
<a name="l00123"></a>00123         <span class="comment">// Burada tempdata array i oluştur (2 dk lık)</span>
<a name="l00124"></a>00124         <span class="comment">// callAPicker fonk.u tempdata alacak şekilde değiştir.</span>
<a name="l00125"></a>00125         <span class="comment">// Pencereyi 1 dk kaydır, baştan başla.</span>
<a name="l00126"></a>00126 <span class="comment">//      int numOfIndexesInOneSecond = (int)(1 / delta); </span>
<a name="l00127"></a>00127 <span class="comment">//      int window = 2 * 60 * numOfIndexesInOneSecond;</span>
<a name="l00128"></a>00128         <span class="keywordtype">float</span> *tempData;
<a name="l00129"></a>00129         tempData = <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="sac_8cpp.html#7ef1b16619d5d4998730fe6343d0654a">windowNum</a>];
<a name="l00130"></a>00130         <span class="comment">// window boyutlu arrayi tempData ya kopyala</span>
<a name="l00131"></a>00131         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> startIndex = 0; startIndex &lt; (long)<a class="code" href="sac_8cpp.html#33fb4519948396073f59faf480e18c19">nlen</a> - <a class="code" href="sac_8cpp.html#7ef1b16619d5d4998730fe6343d0654a">windowNum</a>; startIndex += <a class="code" href="sac_8cpp.html#328345a029b9a68b2dbf673ac84727d5">windowSlideNum</a>)
<a name="l00132"></a>00132         {
<a name="l00133"></a>00133                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="sac_8cpp.html#7ef1b16619d5d4998730fe6343d0654a">windowNum</a>; i++)
<a name="l00134"></a>00134                 {
<a name="l00135"></a>00135                         tempData[i] = <a class="code" href="sac_8cpp.html#57ba9c584cf7756552b7d4370e93395f">data</a>[startIndex + i];
<a name="l00136"></a>00136                 }
<a name="l00137"></a>00137                 <a class="code" href="classsac.html#c6e06e0f852b0e30eb5a48981e553d46">callAPicker</a>(tempData,windowNum);
<a name="l00138"></a>00138                 <span class="comment">//ndxpk 0 olduğu zaman gereksiz pick veriyor.</span>
<a name="l00139"></a>00139                 <span class="keywordflow">if</span>(<a class="code" href="sac_8cpp.html#a40be8b45b8649a7bfe61482161c6102">ndxpk</a> != 0 ) 
<a name="l00140"></a>00140                 {
<a name="l00141"></a>00141                         <a class="code" href="classsac.html#ff949b16be8134d0f2e81a61936d96f9">calculatePickTime</a>(<a class="code" href="sac_8cpp.html#d34fab0272229305cfd14e2348a271fd">nzyear</a>, <a class="code" href="sac_8cpp.html#0dfaef8180fb0cc32bb591f2126160f5">nzjday</a>, <a class="code" href="sac_8cpp.html#710a9f97e615d02344560edcc40ed3cc">nzhour</a>, <a class="code" href="sac_8cpp.html#2bff6107ebc08f6f923c14d4b17a5b10">nzmin</a>, <a class="code" href="sac_8cpp.html#28cce63cfb90bf37cb5ffb2773e84795">nzsec</a>, 
<a name="l00142"></a>00142                                 <a class="code" href="sac_8cpp.html#aa85ccd0618fefb05e39ad9296f37226">nzmsec</a>, <a class="code" href="sac_8cpp.html#a40be8b45b8649a7bfe61482161c6102">ndxpk</a>, <a class="code" href="sac_8cpp.html#1ee4a05b54419bfadd66ee351d05812e">delta</a>, startIndex/(<a class="code" href="sac_8cpp.html#328345a029b9a68b2dbf673ac84727d5">windowSlideNum</a>), windowNum, windowList);
<a name="l00143"></a>00143                 }
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00148"></a><a class="code" href="classsac.html#8f84a629ca40a613402d5de241bc69d8">00148</a> <span class="keywordtype">void</span> <a class="code" href="classsac.html#8f84a629ca40a613402d5de241bc69d8">sac::setWindow</a>(<span class="keywordtype">int</span> windowSec, <span class="keywordtype">int</span> windowSlideSec)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150         <span class="keywordtype">int</span> numOfIndexesInOneSecond = (int)(1 / <a class="code" href="sac_8cpp.html#1ee4a05b54419bfadd66ee351d05812e">delta</a>);
<a name="l00151"></a>00151         <a class="code" href="sac_8cpp.html#7ef1b16619d5d4998730fe6343d0654a">windowNum</a> = windowSec * numOfIndexesInOneSecond;
<a name="l00152"></a>00152         <a class="code" href="sac_8cpp.html#328345a029b9a68b2dbf673ac84727d5">windowSlideNum</a> = windowSlideSec * numOfIndexesInOneSecond;
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00163"></a><a class="code" href="classsac.html#45d899cdee555a22cd89be6692f1921c">00163</a> <span class="keywordtype">int</span> <a class="code" href="classsac.html#45d899cdee555a22cd89be6692f1921c">sac::getWindowListSize</a>(<span class="keywordtype">int</span> windowSlideSec)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165         <span class="comment">// Normalde 1 saatlik veri var ama oncesi ve sonrasi olabilecegi icin 2 kati kadar array size yapalim</span>
<a name="l00166"></a>00166         <span class="keywordflow">return</span> 2 * (3600 / windowSlideSec);
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 
<a name="l00173"></a><a class="code" href="classsac.html#70996c22dc465f5262f04a7002cfc0c6">00173</a> <span class="keywordtype">int</span> <a class="code" href="classsac.html#70996c22dc465f5262f04a7002cfc0c6">sac::calculateMonth</a>(<span class="keywordtype">int</span> year, <span class="keywordtype">int</span> &amp;day)
<a name="l00174"></a>00174 {
<a name="l00175"></a>00175         <span class="keywordtype">int</span> months[] = {31,28,31,30,31,30,31,31,30,31,30,31};
<a name="l00176"></a>00176         <span class="keywordflow">if</span> (year % 4 == 0)
<a name="l00177"></a>00177                 months[1]++;
<a name="l00178"></a>00178         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 11; i++)
<a name="l00179"></a>00179         {
<a name="l00180"></a>00180                 <span class="keywordflow">if</span> (day &lt; months[i])
<a name="l00181"></a>00181                         <span class="keywordflow">return</span> i+1;
<a name="l00182"></a>00182                 <span class="keywordflow">else</span>
<a name="l00183"></a>00183                         day -= months[i];
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185         <span class="keywordflow">return</span> 12;      
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00197"></a><a class="code" href="classsac.html#ff949b16be8134d0f2e81a61936d96f9">00197</a> <span class="keywordtype">void</span> <a class="code" href="classsac.html#ff949b16be8134d0f2e81a61936d96f9">sac::calculatePickTime</a>(<span class="keywordtype">long</span> <a class="code" href="sac_8cpp.html#d34fab0272229305cfd14e2348a271fd">nzyear</a>, <span class="keywordtype">long</span> <a class="code" href="sac_8cpp.html#0dfaef8180fb0cc32bb591f2126160f5">nzjday</a>, <span class="keywordtype">long</span> <a class="code" href="sac_8cpp.html#710a9f97e615d02344560edcc40ed3cc">nzhour</a>,<span class="keywordtype">long</span> <a class="code" href="sac_8cpp.html#2bff6107ebc08f6f923c14d4b17a5b10">nzmin</a>, <span class="keywordtype">long</span> <a class="code" href="sac_8cpp.html#28cce63cfb90bf37cb5ffb2773e84795">nzsec</a>, 
<a name="l00198"></a>00198                                                         <span class="keywordtype">long</span> <a class="code" href="sac_8cpp.html#aa85ccd0618fefb05e39ad9296f37226">nzmsec</a>, <span class="keywordtype">long</span> <a class="code" href="sac_8cpp.html#a40be8b45b8649a7bfe61482161c6102">ndxpk</a>,<span class="keywordtype">float</span> <a class="code" href="sac_8cpp.html#1ee4a05b54419bfadd66ee351d05812e">delta</a>,
<a name="l00199"></a>00199                                                         <span class="keywordtype">int</span> windowNumber, <span class="keywordtype">int</span> windowSize, <a class="code" href="classwindow.html">window</a> windowList[])
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201         <span class="comment">// Saniyeye çevir</span>
<a name="l00202"></a>00202         <span class="keywordtype">double</span> tempTime = (( (nzjday*24 + nzhour)*60 + nzmin)*60 + nzsec) + nzmsec/1000.0;
<a name="l00203"></a>00203         <span class="comment">// Ekle</span>
<a name="l00204"></a>00204         tempTime += windowNumber * (windowSize/2) * delta;
<a name="l00205"></a>00205         tempTime += ndxpk*delta;        
<a name="l00206"></a>00206         
<a name="l00207"></a>00207         <span class="comment">// Geri çevir</span>
<a name="l00208"></a>00208         nzmsec = (long)(1000 * (tempTime - (<span class="keywordtype">int</span>)tempTime));
<a name="l00209"></a>00209         tempTime -= (nzmsec/1000);
<a name="l00210"></a>00210         nzsec = (int)tempTime % 60;
<a name="l00211"></a>00211         tempTime = (int) (tempTime/60);
<a name="l00212"></a>00212         nzmin = (int) tempTime % 60;
<a name="l00213"></a>00213         tempTime = (int) (tempTime/60);
<a name="l00214"></a>00214         nzhour = (int)tempTime % 24;
<a name="l00215"></a>00215         tempTime = (int) (tempTime/24);
<a name="l00216"></a>00216         nzjday = (long)tempTime;
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (nzyear % 4 == 0)
<a name="l00218"></a>00218         {
<a name="l00219"></a>00219                 <span class="keywordflow">if</span> (nzjday &gt; 366)
<a name="l00220"></a>00220                 {
<a name="l00221"></a>00221                         nzyear ++;
<a name="l00222"></a>00222                         nzjday -= 366;
<a name="l00223"></a>00223                 }
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225         <span class="keywordflow">else</span>
<a name="l00226"></a>00226         {
<a name="l00227"></a>00227                 <span class="keywordflow">if</span> (nzjday &gt; 365)
<a name="l00228"></a>00228                 {
<a name="l00229"></a>00229                         nzyear ++;
<a name="l00230"></a>00230                         nzjday -= 365;
<a name="l00231"></a>00231                 }
<a name="l00232"></a>00232         }
<a name="l00233"></a>00233         <span class="keywordtype">string</span> newPick = <span class="stringliteral">""</span>;
<a name="l00234"></a>00234         <span class="keywordtype">string</span> newPickTime = <span class="stringliteral">""</span>;
<a name="l00235"></a>00235         <a class="code" href="classstringop.html">stringop</a> myStr;
<a name="l00236"></a>00236         <span class="comment">//out &lt;&lt; "Window number: " &lt;&lt; windowNumber &lt;&lt; endl;</span>
<a name="l00237"></a>00237         <span class="comment">//istasyon adı 4 karakter</span>
<a name="l00238"></a>00238         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++)
<a name="l00239"></a>00239                 newPick += <a class="code" href="sac_8cpp.html#8599b25176ac5a7eeca5af2a3415d821">kstnm</a>[i];
<a name="l00240"></a>00240                 
<a name="l00241"></a>00241         newPick = newPick + <span class="stringliteral">"EP "</span> + myStr.<a class="code" href="classstringop.html#60be1e09c2d384393d1f5d6a36a4f5d8">ltoa</a>(<a class="code" href="sac_8cpp.html#1a628075fc57be35265c4af95ac761fe">iqual</a>,10) + <span class="stringliteral">" "</span>;
<a name="l00242"></a>00242         
<a name="l00243"></a>00243         <span class="keywordtype">int</span> newday = (int)nzjday;
<a name="l00244"></a>00244         newPickTime += <a class="code" href="classsac.html#4c661cc0f5bb3d17e549fadbf9312062">formattedString</a>(nzyear%100,2);
<a name="l00245"></a>00245         newPickTime += <a class="code" href="classsac.html#4c661cc0f5bb3d17e549fadbf9312062">formattedString</a>(<a class="code" href="classsac.html#70996c22dc465f5262f04a7002cfc0c6">calculateMonth</a>(nzyear,newday),2);
<a name="l00246"></a>00246         newPickTime += <a class="code" href="classsac.html#4c661cc0f5bb3d17e549fadbf9312062">formattedString</a>(newday,2);
<a name="l00247"></a>00247         newPickTime += <a class="code" href="classsac.html#4c661cc0f5bb3d17e549fadbf9312062">formattedString</a>(nzhour,2); 
<a name="l00248"></a>00248         newPickTime += <a class="code" href="classsac.html#4c661cc0f5bb3d17e549fadbf9312062">formattedString</a>(nzmin,2); 
<a name="l00249"></a>00249         newPickTime = newPickTime + <a class="code" href="classsac.html#4c661cc0f5bb3d17e549fadbf9312062">formattedString</a>(nzsec,3) + <span class="stringliteral">"."</span>;
<a name="l00250"></a>00250         newPick += newPickTime;
<a name="l00251"></a>00251         <span class="keywordflow">if</span> (nzmsec &gt; 100)
<a name="l00252"></a>00252         {
<a name="l00253"></a>00253                 newPick = newPick + myStr.<a class="code" href="classstringop.html#60be1e09c2d384393d1f5d6a36a4f5d8">ltoa</a>(nzmsec/10,10);
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255         <span class="keywordflow">else</span>
<a name="l00256"></a>00256         {
<a name="l00257"></a>00257                 <span class="keywordflow">if</span> (nzmsec &gt; 10)
<a name="l00258"></a>00258                         newPick = newPick + myStr.<a class="code" href="classstringop.html#60be1e09c2d384393d1f5d6a36a4f5d8">ltoa</a>(nzmsec,10);
<a name="l00259"></a>00259                 <span class="keywordflow">else</span>
<a name="l00260"></a>00260                         newPick = newPick + <span class="stringliteral">"0"</span> + myStr.<a class="code" href="classstringop.html#60be1e09c2d384393d1f5d6a36a4f5d8">ltoa</a>(nzmsec,10);
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262         
<a name="l00263"></a>00263         <span class="comment">//cout &lt;&lt; "newPickTime: " &lt;&lt; setprecision(15) &lt;&lt; atof(newPickTime.c_str()) &lt;&lt; " window: " &lt;&lt; windowNumber &lt;&lt; endl;</span>
<a name="l00264"></a>00264         windowList[windowNumber].<a class="code" href="classwindow.html#138a32c2868ac641a7d1338c76e58894">addPick</a>(newPick, atof(newPickTime.c_str()), ndxpk);
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00270"></a><a class="code" href="classsac.html#4c661cc0f5bb3d17e549fadbf9312062">00270</a> <span class="keywordtype">string</span> <a class="code" href="classsac.html#4c661cc0f5bb3d17e549fadbf9312062">sac::formattedString</a>(<span class="keywordtype">int</span> number, <span class="keywordtype">int</span> digits)
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272         <a class="code" href="classstringop.html">stringop</a> mystring;
<a name="l00273"></a>00273         <span class="keywordtype">string</span> str_num = mystring.<a class="code" href="classstringop.html#1efd534ebc63510e7faf2882ced186ec">itoa</a>(number,10);
<a name="l00274"></a>00274         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = str_num.length(); i &lt; digits; i++)
<a name="l00275"></a>00275         {
<a name="l00276"></a>00276                 str_num = <span class="stringliteral">"0"</span> + str_num; 
<a name="l00277"></a>00277         } 
<a name="l00278"></a>00278         <span class="keywordflow">return</span> str_num;
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00284"></a><a class="code" href="classsac.html#4c400410aaaed4998486fbbf2eb04829">00284</a> <span class="keywordtype">void</span> <a class="code" href="classsac.html#4c400410aaaed4998486fbbf2eb04829">sac::createHypoHeader</a>(std::ofstream&amp; out)
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286         <span class="keywordtype">string</span> line;
<a name="l00287"></a>00287         ifstream myfile (<span class="stringliteral">"template.txt"</span>);
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (myfile.is_open())
<a name="l00289"></a>00289         {
<a name="l00290"></a>00290                 <span class="keywordflow">while</span> (! myfile.eof() )
<a name="l00291"></a>00291         {
<a name="l00292"></a>00292                         getline (myfile,line);
<a name="l00293"></a>00293                         out &lt;&lt; line &lt;&lt; endl;
<a name="l00294"></a>00294                 }
<a name="l00295"></a>00295                 myfile.close();
<a name="l00296"></a>00296         }                                       
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00300"></a><a class="code" href="classsac.html#5c4b918f4a8dfb73884f5dfa7f4739f9">00300</a> <span class="keywordtype">void</span> <a class="code" href="classsac.html#5c4b918f4a8dfb73884f5dfa7f4739f9">sac::createHypoFooter</a>(std::ofstream&amp; out)
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302         out &lt;&lt; endl &lt;&lt; <span class="stringliteral">"                 10"</span>&lt;&lt;endl;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Sat Jul 14 00:58:11 2007 for Kandilli Earthquake Seismic Data Server and Analysis by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>

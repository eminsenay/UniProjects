      SUBROUTINE AZWTOS                                                  134.
C------- AZIMUTHAL WEIGHTING OF STATIONS BY QUADRANTS ------------------ 135.
      REAL LAT,LON,MAG
      COMMON /A2/ LAT(1501),LON(1501),DELTA(1501),
     1       DX(1501),DY(1501),T(1501)                                   136.
      COMMON /A6/ NMAX,LMAX,NS,NL,MMAX,NR,FNO,Z,
     1       X(4,1501),ZSQ,NRP,DF(1501)                                  137.
      COMMON /A7/ KP,KZ,KOUT,WT(1501),Y(4),SE(4),XMEAN(4),
     1       CP(180),SP(180)                                             138.
      COMMON /A8/ CAL(1501),XMAG(1501),FMAG(1501),NM,AVXM,SDXM,NF,AVFM,  139.
     1       SDFM,MAG,KDX(1501),AMX(1501),PRX(1501),CALX(1501),FMP(1501) 140.
      COMMON /A10/ ANIN(1501),AZ(1501),TEMP(1501),CA(71),CB(71)          141.
      COMMON /A13/ JDX(1501),LDX(1501),KEY(1501),CLASS(4)                142.
      COMMON /A25/ INS(1501),IEW(1501),JPH                               143.
      DIMENSION TX(4),TXN(4),KTX(4),KEMP(1501)                           144.
      DATA KS1,KW1/'S','W'/                                              145.
C----------------------------------------------------------------------- 146.
      J=0                                                                147.
      DO 10 I=1,NR                                                       148.
      IF (WT(I) .EQ. 0.) GO TO 10                                        149.
      DXI=DX(I)                                                          150.
      DYI=DY(I)                                                          151.
      IF ((DXI.EQ.0.).AND.(DYI.EQ.0.)) GO TO 6                           152.
      JI=KDX(I)                                                          153.
      IF (INS(JI) .EQ. KS1) DYI=-DYI                                     154.
      IF (IEW(JI) .EQ. KW1) DXI=-DXI                                     155.
      AZ(I)=AMOD(ATAN2(DXI,DYI)*57.29578 + 360., 360.)                   156.
      GO TO 7                                                            157.
    6 AZ(I)=999.                                                         158.
    7 J=J+1                                                              159.
      TEMP(J)=AZ(I)                                                      160.
   10 CONTINUE                                                           161.
      CALL SORT(TEMP,KEY,J)                                              162.
      GAP=TEMP(1)+360.-TEMP(J)                                           163.
      IG=1                                                               164.
      DO 20 I=2,J                                                        165.
      DTEMP=TEMP(I)-TEMP(I-1)                                            166.
      IF (DTEMP .LE. GAP) GO TO 20                                       167.
      GAP=DTEMP                                                          168.
      IG=I                                                               169.
   20 CONTINUE                                                           170.
      TX(1)=TEMP(IG)-0.5*GAP                                             171.
      TX(2)=TX(1)+90.                                                    172.
      TX(3)=TX(1)+180.                                                   173.
      TX(4)=TX(1)+270.                                                   174.
      DO 124 I=1,4                                                       175.
      TXN(I)=0.                                                          176.
      IF (TX(I) .LT. 0.) TX(I)=TX(I)+360.                                177.
      IF (TX(I).GT.360.) TX(I)=TX(I)-360.                                178.
  124 CONTINUE                                                           179.
      CALL SORT(TX,KTX,4)                                                180.
      DO 130 I=1,NR                                                      181.
      IF (WT(I) .EQ. 0.) GO TO 130                                       182.
      IF (AZ(I) .GT. TX(1)) GO TO 126                                    183.
  125 TXN(1)=TXN(1)+1.                                                   184.
      KEMP(I)=1                                                          185.
      GO TO 130                                                          186.
  126 IF (AZ(I) .GT. TX(2)) GO TO 127                                    187.
      TXN(2)=TXN(2)+1.                                                   188.
      KEMP(I)=2                                                          189.
      GO TO 130                                                          190.
  127 IF (AZ(I) .GT. TX(3)) GO TO 128                                    191.
      TXN(3)=TXN(3)+1.                                                   192.
      KEMP(I)=3                                                          193.
      GO TO 130                                                          194.
  128 IF (AZ(I) .GT. TX(4)) GO TO 125                                    195.
      TXN(4)=TXN(4)+1.                                                   196.
      KEMP(I)=4                                                          197.
  130 CONTINUE                                                           198.
      XN=4                                                               199.
      IF (TXN(1).EQ.0.) XN=XN-1                                          200.
      IF (TXN(2).EQ.0.) XN=XN-1                                          201.
      IF (TXN(3).EQ.0.) XN=XN-1                                          202.
      IF (TXN(4).EQ.0.) XN=XN-1                                          203.
      FJ=J/XN                                                            204.
      DO 150 I=1,NR                                                      205.
      IF (WT(I) .EQ. 0.) GO TO 150                                       206.
      KI=KEMP(I)                                                         207.
      WT(I)=WT(I)*FJ/TXN(KI)                                             208.
  150 CONTINUE                                                           209.
      RETURN                                                             210.
      END                                                                211.
      BLOCK DATA                                                         212.
C------INITIALIZE CONSTANTS IN COMMON STATEMENTS ------------------------213.	
      COMMON /A6/ NMAX,LMAX,NS,NL,MMAX,NR,FNO,Z,
     1       X(4,1501),ZSO,NRP,DF(1501) 
      COMMON /A10/ ANIN(1501),AZ(1501),TEMP(1501),CA(71),CB(71)             215.
      COMMON /A13/ JDX(1501),LDX(1501),KEY(1501),CLASS(4)                   216.
      COMMON /A14/ MBK,MDOL,BLANK,MSTAR,DOT,STAR4,QUES,CRMK,MCENT,ISTAR  217.
      COMMON /A22/ F(21,21),G(4,21),H(21),DEPTH(21),IONE                 218.
      COMMON /A24/ FLTEP,IPRO,ISTTT,ISKP(4),AHEAD(12),FLIM,AF(3),NDEC    219.
      DATA CA/  1.855365,1.855369,1.855374,1.855383,1.855396,1.855414,   220.
     1 1.855434,1.855458,1.855487,1.855520,1.855555,1.855595,1.855638,   221.
     2 1.855683,1.855733,1.855786,1.855842,1.855902,1.855966,1.856031,   222.
     3 1.856100,1.856173,1.856248,1.856325,1.856404,1.856488,1.856573,   223.
     4 1.856661,1.856750,1.856843,1.856937,1.857033,1.857132,1.857231,   224.
     5 1.857331,1.857435,1.857538,1.857643,1.857750,1.857858,1.857964,   225.
     6 1.858074,1.858184,1.858294,1.858403,1.858512,1.858623,1.858734,   226.
     7 1.858842,1.858951,1.859061,1.859170,1.859276,1.859384,1.859488,   227.
     8 1.859592,1.859695,1.859798,1.859896,1.859995,1.860094,1.860187,   228.
     9 1.860279,1.860369,1.860459,1.860544,1.860627,1.860709,1.860787,   229.
     A 1.860861,1.860934/                                                230.
      DATA CB/  1.842808,1.842813,1.842830,1.842858,1.842898,1.842950,   231.
     1 1.843011,1.843085,1.843170,1.843265,1.843372,1.843488,1.843617,   232.
     2 1.843755,1.843903,1.844062,1.844230,1.844408,1.844595,1.844792,   233.
     3 1.844998,1.845213,1.845437,1.845668,1.845907,1.846153,1.846408,   234.
     4 1.846670,1.846938,1.847213,1.847495,1.847781,1.848073,1.848372,   235.
     5 1.848673,1.848980,1.849290,1.849605,1.849922,1.850242,1.850565,   236.
     6 1.850890,1.851217,1.851543,1.851873,1.852202,1.852531,1.852860,   237.
     7 1.853188,1.853515,1.853842,1.854165,1.854487,1.854805,1.855122,   238.
     8 1.855433,1.855742,1.856045,1.856345,1.856640,1.856928,1.857212,   239.
     9 1.857490,1.857762,1.858025,1.858283,1.858533,1.858775,1.859008,   240.
     A 1.859235,1.859452/                                                241.
      DATA MBK,DOT,MSTAR,MDOL,MCENT/'    ',' .  ',' ***',' $$$',' ccc'/  242.
      DATA ISTTT/' ** '/                                                 243.
      DATA BLANK,STAR4,CLASS/'    ','****','A','B','C','D'/,QUES/'?'/    244.
      DATA LMAX,MMAX,NMAX/21,1501,1501/,CRMK,ISTAR,IONE/'CAL',
     1'*','1   '/  
      DATA AHEAD/'    ','    ','    ','    ','    ','    ','    ',       246.
     1 '    ','    ','    ','    ','    '/                               247.
      END                                                                248.
